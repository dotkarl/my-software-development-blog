<ul>
    {{ $currentPage := . }}
    <li id="search-menu-item" style="position:relative;">
        <svg id="search-icon" 
          tabindex="0"
          role="button"
          aria-label="Zoeken"
          aria-expanded="false"
          style="cursor:pointer; width:20px; height:20px; vertical-align:middle; fill:currentColor;"
          viewBox="0 0 24 24">
            <path d="M10.5 3a7.5 7.5 0 015.92 12.18l4.2 4.2a1 1 0 01-1.42 1.42l-4.2-4.2A7.5 7.5 0 1110.5 3zm0 2a5.5 5.5 0 100 11 5.5 5.5 0 000-11z"/>
        </svg>
        <input class="search-overlay-input" type="text" id="search-input" placeholder="Zoeken..." />
    </li>
    {{ range .Site.Menus.main }}
        <li>
            <a href="{{ .URL }}">
                {{ .Pre | safeHTML }}
                <span>{{ .Name }}</span>
                {{ .Post }}
            </a>
        </li>
    {{ end }}

</ul>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const icon = document.getElementById('search-icon');
  const input = document.getElementById('search-input');

  function showSearchInput() {
    input.classList.add('active');
    icon.setAttribute('aria-expanded', 'true');
    input.focus();
  }

  function hideSearchInput() {
    input.classList.remove('active');
    icon.setAttribute('aria-expanded', 'false');
  }

  function toggleSearchInput() {
    if (input.classList.contains('active')) {
      hideSearchInput();
    } else {
      showSearchInput();
    }
  }

  // Toggle on icon click or keyboard activation
  icon.addEventListener('click', (event) => {
    toggleSearchInput();
    event.stopPropagation();
  });
  icon.addEventListener('keydown', (event) => {
    if (event.key === 'Enter' || event.key === ' ') {
      toggleSearchInput();
      event.preventDefault();
      event.stopPropagation();
    }
  });

  // Prevent input click from closing it
  input.addEventListener('click', (event) => {
    event.stopPropagation();
  });

  // Handle search and tab-out
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      window.open(
        'https://www.google.com/search?q=site:www.karlvanheijster.com+' + encodeURIComponent(input.value),
        '_blank'
      );
    } else if (e.key === 'Tab') {
      hideSearchInput();
    }
  });

  // Hide input when clicking elsewhere
  document.addEventListener('click', () => {
    if (input.classList.contains('active')) {
      hideSearchInput();
    }
  });
});
</script>